name: Organize Algorithm Solutions

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰
  push:
    branches: [ main ] # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œë§ˆë‹¤ ë¬´ì¡°ê±´ ì‹¤í–‰

jobs:
  organize-and-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 2 # ìµœì‹  ì»¤ë°‹ê³¼ ê·¸ ì´ì „ ì»¤ë°‹ì„ ë¹„êµí•˜ê¸° ìœ„í•´ fetch-depthë¥¼ 2 ì´ìƒìœ¼ë¡œ ì„¤ì •

      - name: Move LeetCode solutions if they exist
        id: move_leethub
        run: |
          # ë£¨íŠ¸ì— LeetCode ë¬¸ì œ í´ë”ê°€ ìˆëŠ”ì§€ í™•ì¸
          if ls -d [0-9][0-9][0-9][0-9]-* &> /dev/null; then
            echo "âœ… New LeetCode solution directories found. Moving them..."
            mkdir -p LeetCode
            for d in [0-9][0-9][0-9][0-9]-*; do
              if [ -d "$d" ]; then
                # -v ì˜µì…˜ìœ¼ë¡œ ì´ë™ ê³¼ì •ì„ ë¡œê·¸ì— ëª…í™•íˆ í‘œì‹œ
                mv -v "$d" "LeetCode/"
              fi
            done
          else
            echo "â„¹ï¸ No new LeetCode directories to move."
          fi

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Update README for Baekjoon if changed
        id: update_readme
        run: |
          # ê°€ì¥ ìµœê·¼ ì»¤ë°‹ì—ì„œ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ì„ í™•ì¸í•˜ì—¬ 'ë°±ì¤€/' í´ë” ë³€ê²½ ê°ì§€
          if git diff --name-only HEAD~1 HEAD | grep -q "ë°±ì¤€/"; then
            echo "âœ… Changes detected in 'ë°±ì¤€/' directory. Updating README..."
            python scripts/update_readme.py
          else
            echo "â„¹ï¸ No changes in 'ë°±ì¤€/' directory. Skipping README update."
          fi

      - name: Commit & Push changes if there are any
        run: |
          # git statusë¡œ ì‹¤ì œ íŒŒì¼ ë³€ê²½ì´ ìˆëŠ”ì§€ ìµœì¢… í™•ì¸
          if ! git diff --quiet HEAD; then
            git config --global user.name 'github-actions[bot]'
            git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
            # â—ï¸ git add -A ë¡œ ë³€ê²½í•˜ì—¬ ëª¨ë“  ë³€ê²½ì‚¬í•­(ì‚­ì œ í¬í•¨)ì„ ì¶”ì 
            git add -A
            git commit -m "chore(auto): Organize solutions & update README" -m "LeetCode í´ë”ë¥¼ ì •ë¦¬í•˜ê³  ë°±ì¤€ ë¬¸ì œ ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤."
          
            # â—ï¸í‘¸ì‹œ ì§ì „ pull --rebaseë¥¼ ì‹¤í–‰í•˜ì—¬ íƒ€ì´ë° ë¬¸ì œ(Race Condition) í•´ê²°
            git pull --rebase
          
            echo "ğŸš€ Pushing changes to repository..."
            git push
          else
            echo "âœ… No changes to commit."
          fi

##name: Move LeetCode Solutions
##
##on:
##  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ì˜µì…˜ ìœ ì§€
##  push:
##    paths:
##      - '[0-9][0-9][0-9][0-9]-*/**'  # LeetHubê°€ ìƒì„±í•˜ëŠ” í´ë” íŒ¨í„´ (ì˜ˆ: 0020-valid-parentheses)
##
##jobs:
##  move-files:
##    runs-on: ubuntu-latest
##    permissions:
##      contents: write
##    steps:
##      - name: Checkout repository
##        uses: actions/checkout@v3
##        with:
##          fetch-depth: 2  # ìµœê·¼ ì»¤ë°‹ ê¸°ë¡ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì„¤ì •
##
##      - name: Move LeetCode solutions
##        run: |
##          # ë””ë²„ê¹…ì„ ìœ„í•œ í˜„ì¬ ë””ë ‰í† ë¦¬ ë‚´ìš© ì¶œë ¥
##          echo "Current directory contents:"
##          ls -la
##
##          # LeetCode í´ë”ê°€ ì—†ë‹¤ë©´ ìƒì„±
##          mkdir -p LeetCode
##
##          # ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ í™•ì¸
##          echo "Changed files in this push:"
##          git diff --name-only HEAD^ HEAD
##
##          # LeetHubê°€ ìƒì„±í•œ í´ë”ë“¤ì„ LeetCode í´ë”ë¡œ ì´ë™
##          found=0
##          for d in [0-9][0-9][0-9][0-9]-*; do
##            if [ -d "$d" ]; then
##              echo "Moving directory: $d"
##              mv "$d" "LeetCode/" && found=1
##            fi
##          done
##
##          # ì´ë™í•  í´ë”ë¥¼ ì°¾ì§€ ëª»í–ˆì„ ê²½ìš°ì—ë„ ì˜¤ë¥˜ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
##          if [ $found -eq 0 ]; then
##            echo "No matching directories found to move"
##          fi
##
##      - name: Commit & Push changes
##        run: |
##          # ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸
##          if git status --porcelain | grep .; then
##            git config --global user.name 'github-actions[bot]'
##            git config --global user.email 'github-actions[bot]@users.noreply.github.com'
##            git add -A
##            git commit -m "chore: Move LeetCode solutions to LeetCode folder"
##            git push
##          else
##            echo "No changes to commit"
##          fi
